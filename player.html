<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Player</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  background:#111;
  color:#eee;
  font-family:Arial, sans-serif;
  padding:20px;
}
input,button{
  padding:8px;
  margin:6px 0;
  font-size:16px;
}
.mods label{
  display:block;
}
#erro{color:#ff5555;}
</style>
</head>
<body>

<h2>Rolagem de Dados</h2>

<input id="qtd" type="number" min="1" placeholder="Quantidade de d12">

<div class="mods">
  <label><input type="checkbox" id="ordem3"> Ordem 3</label>
  <label><input type="checkbox" id="vantagem"> Vantagem</label>
  <label><input type="checkbox" id="desvantagem"> Desvantagem</label>
</div>

<button onclick="rolar()">Lan√ßar</button>

<p id="erro"></p>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBzniGkaFn9HzyeS9XhQ9cAETXWIPFcsQw",
  authDomain: "sociedade-mitra-dados.firebaseapp.com",
  databaseURL: "https://sociedade-mitra-dados-default-rtdb.firebaseio.com",
  projectId: "sociedade-mitra-dados",
  storageBucket: "sociedade-mitra-dados.firebasestorage.app",
  messagingSenderId: "155136545326",
  appId: "1:155136545326:web:b9721595277fb7cef685bf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function rolar(){
  erro.textContent = '';

  const mods = [ordem3.checked, vantagem.checked, desvantagem.checked].filter(v=>v).length;
  if(mods > 1){
    erro.textContent = 'Escolha apenas um modificador';
    return;
  }

  const n = Number(qtd.value);
  if(!n || n < 1) return;

  let dados = [];
  for(let i=0;i<n;i++){
    dados.push(Math.floor(Math.random()*12)+1);
  }

  // Desvantagem (prioriza maiores)
  if(desvantagem.checked && dados.includes(1)){
    dados.sort((a,b)=>b-a);
    for(let i=0;i<dados.length;i++){
      if(dados[i] >= 8){
        dados[i] = 7;
        break;
      }
    }
  }

  // Vantagem
  if(vantagem.checked && dados.includes(12)){
    for(let i=0;i<dados.length;i++){
      if(dados[i] < 7){
        dados[i] = 8;
        break;
      }
    }
  }

  let sucessos = 0;
  dados.forEach(d=>{
    if(d === 12) sucessos += ordem3.checked ? 3 : 2;
    else if(d >= 8) sucessos += 1;
  });

  db.ref("dados").set({
    sucessos,
    timestamp: Date.now()
  });
}
</script>

</body>
</html>
