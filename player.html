<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Rolagem de Dados</title>

<style>
body{
  margin:0;
  background:#0f141c;
  color:#fff;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#painel{
  background:#151c28;
  padding:20px;
  border-radius:10px;
  width:280px;
  text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,.6);
}

input, button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:6px;
  font-size:16px;
}

button{
  background:#2d6cdf;
  color:white;
  cursor:pointer;
}

label{
  display:block;
  margin-top:6px;
  font-size:14px;
}

#dadosIndividuais{
  margin-top:12px;
  font-size:14px;
  color:#ccc;
  word-wrap:break-word;
}
</style>
</head>

<body>

<div id="painel">
  <h3>Rolagem</h3>

  <input type="number" id="qtd" placeholder="Quantidade de d12">

  <label><input type="checkbox" id="ordem3"> Ordem 3</label>
  <label><input type="checkbox" id="vantagem"> Vantagem</label>
  <label><input type="checkbox" id="desvantagem"> Desvantagem</label>

  <button onclick="rolar()">Lan√ßar</button>

  <div id="dadosIndividuais"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBzniGkaFn9HzyeS9XhQ9cAETXWIPFcsQw",
  authDomain: "sociedade-mitra-dados.firebaseapp.com",
  databaseURL: "https://sociedade-mitra-dados-default-rtdb.firebaseio.com",
  projectId: "sociedade-mitra-dados",
  storageBucket: "sociedade-mitra-dados.firebasestorage.app",
  messagingSenderId: "155136545326",
  appId: "1:155136545326:web:b9721595277fb7cef685bf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function rolar(){
  const qtd = parseInt(document.getElementById("qtd").value);
  const ordem3 = ordem3El = document.getElementById("ordem3").checked;
  const vantagem = document.getElementById("vantagem").checked;
  const desvantagem = document.getElementById("desvantagem").checked;

  if([ordem3, vantagem, desvantagem].filter(v=>v).length > 1){
    alert("Marque apenas um modificador.");
    return;
  }

  let dados = [];
  let exibicao = [];

  for(let i=0;i<qtd;i++){
    let v = Math.floor(Math.random()*12)+1;
    dados.push(v);
    exibicao.push(v.toString());
  }

  if(desvantagem && dados.includes(1)){
    let alvo = dados
      .map((v,i)=>({v,i}))
      .filter(o=>o.v>=8)
      .sort((a,b)=>b.v-a.v)[0];

    if(alvo){
      exibicao[alvo.i] = `7(${dados[alvo.i]})`;
      dados[alvo.i] = 7;
    }
  }

  if(vantagem && dados.includes(12)){
    let idx = dados.findIndex(v=>v<7);
    if(idx !== -1){
      exibicao[idx] = `8(${dados[idx]})`;
      dados[idx] = 8;
    }
  }

  let sucessos = 0;
  dados.forEach(v=>{
    if(v>=8 && v<=11) sucessos++;
    if(v===12) sucessos += ordem3 ? 3 : 2;
  });

  document.getElementById("dadosIndividuais").textContent =
    "Dados: " + exibicao.join(", ");

  db.ref("resultado").set({
    sucessos,
    time: Date.now()
  });
}
</script>

</body>
</html>
