<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Player</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="player">

<h2>Rolagem</h2>

<input id="qtd" type="number" min="1" placeholder="Qtd d12">

<div class="mods">
  <label><input type="checkbox" id="ordem3"> Ordem 3</label>
  <label><input type="checkbox" id="vantagem"> Vantagem</label>
  <label><input type="checkbox" id="desvantagem"> Desvantagem</label>
</div>

<button onclick="rolar()">Lan√ßar</button>

<p id="erro"></p>

<script>
const canal = new BroadcastChannel('dados_rpg');

function rolar(){
  erro.textContent = '';

  const mods = [ordem3.checked, vantagem.checked, desvantagem.checked]
    .filter(v=>v).length;

  if(mods > 1){
    erro.textContent = 'Escolha apenas um modificador';
    return;
  }

  const n = Number(qtd.value);
  if(!n || n < 1) return;

  let dados = [];
  for(let i=0;i<n;i++){
    dados.push(Math.floor(Math.random()*12)+1);
  }

  // DESVANTAGEM (prioriza maiores)
  if(desvantagem.checked){
    dados.sort((a,b)=>b-a);
    if(dados.includes(1)){
      for(let i=0;i<dados.length;i++){
        if(dados[i] >= 8){
          dados[i] = 7;
          break;
        }
      }
    }
  }

  // VANTAGEM
  if(vantagem.checked){
    if(dados.includes(12)){
      for(let i=0;i<dados.length;i++){
        if(dados[i] < 7){
          dados[i] = 8;
          break;
        }
      }
    }
  }

  let sucessos = 0;
  dados.forEach(d=>{
    if(d === 12) sucessos += ordem3.checked ? 3 : 2;
    else if(d >= 8) sucessos += 1;
  });

  // ENVIA PARA O OBS
  canal.postMessage({
    sucessos,
    dados
  });
}
</script>

</body>
</html>
