<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  background:#0e0e0e;
  color:#eee;
  font-family:Arial, sans-serif;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  background:#161616;
  padding:24px;
  border-radius:12px;
  width:320px;
  box-shadow:0 0 20px rgba(0,0,0,.6);
}

h2{
  text-align:center;
  margin-bottom:16px;
}

input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:16px;
  border-radius:6px;
  border:none;
}

button{
  background:#2b2b2b;
  color:#fff;
  cursor:pointer;
}

.mods label{
  display:block;
  margin:4px 0;
}

#erro{
  color:#ff5555;
  text-align:center;
}

#resultado{
  text-align:center;
  margin-top:16px;
}

#numero{
  font-size:48px;
  display:none;
}

video{
  width:160px;
  display:none;
  margin:auto;
}
</style>
</head>
<body>

<div class="container">
<h2>Rolagem</h2>

<input id="qtd" type="number" min="1" placeholder="Quantidade de d12">

<div class="mods">
  <label><input type="checkbox" id="ordem3"> Ordem 3</label>
  <label><input type="checkbox" id="vantagem"> Vantagem</label>
  <label><input type="checkbox" id="desvantagem"> Desvantagem</label>
</div>

<button onclick="rolar()">Lançar</button>
<p id="erro"></p>

<div id="resultado">
  <video id="video" src="dice_animation.webm" muted playsinline></video>
  <div id="numero"></div>
  <div>Sucessos</div>
</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBzniGkaFn9HzyeS9XhQ9cAETXWIPFcsQw",
  authDomain: "sociedade-mitra-dados.firebaseapp.com",
  databaseURL: "https://sociedade-mitra-dados-default-rtdb.firebaseio.com",
  projectId: "sociedade-mitra-dados",
  storageBucket: "sociedade-mitra-dados.firebasestorage.app",
  messagingSenderId: "155136545326",
  appId: "1:155136545326:web:b9721595277fb7cef685bf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function rolar(){
  erro.textContent = '';
  numero.style.display='none';

  const mods = [ordem3.checked, vantagem.checked, desvantagem.checked].filter(v=>v).length;
  if(mods > 1){
    erro.textContent = 'Escolha apenas um modificador';
    return;
  }

  const n = Number(qtd.value);
  if(!n || n < 1) return;

  let dados=[];
  for(let i=0;i<n;i++) dados.push(Math.floor(Math.random()*12)+1);

  if(desvantagem.checked && dados.includes(1)){
    dados.sort((a,b)=>b-a);
    for(let i=0;i<dados.length;i++){
      if(dados[i]>=8){ dados[i]=7; break; }
    }
  }

  if(vantagem.checked && dados.includes(12)){
    for(let i=0;i<dados.length;i++){
      if(dados[i]<7){ dados[i]=8; break; }
    }
  }

  let sucessos=0;
  dados.forEach(d=>{
    if(d===12) sucessos+= ordem3.checked ? 3 : 2;
    else if(d>=8) sucessos++;
  });

  // PLAYER ANIMAÇÃO
  video.style.display='block';
  video.currentTime=0;
  video.play();

  setTimeout(()=>{
    numero.textContent=sucessos;
    numero.style.display='block';
  },1000);

  setTimeout(()=>{
    video.style.display='none';
  },7000);

  // ENVIA PRO OBS
  db.ref("dados").set({sucessos, ts:Date.now()});
}
</script>

</body>
</html>
